# ### 1. CREATE THE GRAPH #####
blocks:
- name: create-graph
  tags:
   phase: create-graph
  statements:
    - system.graph('<<nameofgraph:test>>').ifNotExists().create()

# ### 2. DEV MODE FOR SCHEMA-FREE INSERTION OF AIR ROUTES #####
# ### Creates a schema-less environment and prepares ds graph for auto schema detection
# ### this is okay because we just want to learn some Gremlin.
# ### this is never advisable for production applications
- name: graph-schema
  tags:
   phase: graph-schema
  statements:
   - >-
    schema.propertyKey("icao").Text().single().create()
    schema.propertyKey("dist").Int().single().create()
    schema.propertyKey("city").Text().single().create()
    schema.propertyKey("runways").Int().single().create()
    schema.propertyKey("lat").Double().single().create()
    schema.propertyKey("code").Text().single().create()
    schema.propertyKey("region").Text().single().create()
    schema.propertyKey("desc").Text().single().create()
    schema.propertyKey("type").Text().single().create()
    schema.propertyKey("elev").Int().single().create()
    schema.propertyKey("longest").Int().single().create()
    schema.propertyKey("country").Text().single().create()
    schema.propertyKey("lon").Double().single().create()
    schema.edgeLabel("route").multiple().properties("dist").create()
    schema.edgeLabel("contains").multiple().create()
    schema.vertexLabel("airport").properties("country", "code", "longest", "city", "elev", "icao", "lon", "type", "region", "runways", "lat", "desc").create()
    schema.vertexLabel("version").properties("code", "type", "desc").create()
    schema.vertexLabel("country").properties("code", "type", "desc").create()
    schema.vertexLabel("continent").properties("code", "type", "desc").create()
    schema.edgeLabel("route").connection("airport", "airport").add()
    schema.edgeLabel("contains").connection("country", "airport").connection("continent", "airport").add()
    schema.config().option('graph.schema_mode').set('Development')
    schema.config().option('graph.allow_scan').set('true')
    schema.config().option("tx_autostart").set(true)

# ### 3. CREATE THE SCHEMA #####
- name: read-graph
  tags:
   phase: read-graph
  statements:
    >-
    graph.io(IoCore.graphml()).readGraph("/tmp/gremlin-workshop/data/air-routes.graphml")